# FR-085: Velostream Product Architecture

> **Document Purpose**: High-level architecture for the complete Velostream product portfolio
> **Last Updated**: November 27, 2025

---

## Executive Summary

Velostream is positioned as **"The Real-Time Data Layer for AI"** â€” a streaming SQL platform with turnkey applications for AI observability, data replication, and governance.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      VELOSTREAM                              â”‚
â”‚           The Real-Time Data Layer for AI                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  PLATFORM (Open Source - Apache 2.0)                        â”‚
â”‚  â€¢ Streaming SQL engine        â€¢ @metric annotations        â”‚
â”‚  â€¢ 42x faster financial precision (ScaledInteger)           â”‚
â”‚  â€¢ PyFlink replacement (<10Âµs Python IPC)                   â”‚
â”‚  â€¢ Test harness with synthetic data (FR-084)                â”‚
â”‚  â€¢ CLI tools (velo run, velo test)                          â”‚
â”‚                                                              â”‚
â”‚  TURNKEY APPS (Commercial)                                   â”‚
â”‚  â€¢ AI Black Box Recorder    â€” Audit every AI decision       â”‚
â”‚  â€¢ Cluster Linker           â€” 80% cheaper than Confluent    â”‚
â”‚  â€¢ AI Semantic Lineage      â€” Explain what data drove AI    â”‚
â”‚                                                              â”‚
â”‚  ENTERPRISE LICENSE (Commercial)                             â”‚
â”‚  â€¢ RBAC, SSO/SAML, Audit Logs                               â”‚
â”‚  â€¢ Multi-node clustering                                     â”‚
â”‚  â€¢ Chaos + regression testing                                â”‚
â”‚  â€¢ Pipeline lineage + impact analysis                        â”‚
â”‚                                                              â”‚
â”‚  STUDIO (FR-085 - Open Source + Commercial)                  â”‚
â”‚  â€¢ AI-powered notebook interface                             â”‚
â”‚  â€¢ NLâ†’SQL with live updating charts                          â”‚
â”‚  â€¢ One-click deploy to production                            â”‚
â”‚  â€¢ Grafana dashboard generation                              â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Product Tiers

### Tier 1: Open Source Platform (Apache 2.0)

The foundation that drives adoption.

| Component | Description | Status |
|-----------|-------------|--------|
| **Streaming SQL Engine** | Parse, plan, execute streaming SQL | âœ… Complete |
| **Connectors** | Kafka, Postgres, Redis, File | âœ… Complete |
| **Test Harness (FR-084)** | Synthetic data, assertions, AI analysis | âœ… Complete |
| **@metric Annotations** | SQL comments â†’ Prometheus metrics | âœ… Complete |
| **CLI Tools** | `velo run`, `velo test`, `velo validate` | âœ… Complete |
| **Financial Precision** | ScaledInteger (42x faster than f64) | âœ… Complete |
| **Python IPC (FR-072)** | <10Âµs Python integration | âœ… Complete |
| **Studio (Basic)** | Notebook UI, NLâ†’SQL, visualization | ğŸ”§ FR-085 |

### Tier 2: Turnkey Apps (Commercial)

Pre-built solutions that solve specific problems.

| App | Description | Pricing | Status |
|-----|-------------|---------|--------|
| **AI Black Box Recorder** | Capture, query, replay AI agent decisions | $0.001/decision | ğŸ”§ Planned |
| **Cluster Linker** | Cross-cluster Kafka replication (multi-vendor) | $0.05/GB | ğŸ”§ Planned |
| **AI Semantic Lineage** | Trace data sources in AI decisions | $2K-20K/mo | ğŸ”§ Planned |

### Tier 3: Enterprise License (Commercial)

Features for scale, security, and compliance.

| Feature | Description | Status |
|---------|-------------|--------|
| **SSO/SAML/OIDC** | Enterprise identity integration | ğŸ”§ Planned |
| **RBAC** | Role-based access control | ğŸ”§ Planned |
| **Audit Logging** | SOC2/HIPAA compliance | ğŸ”§ Planned |
| **Multi-node Clustering** | Horizontal scaling | ğŸ”§ Planned |
| **Chaos Testing** | Inject failures before deploy | ğŸ”§ Planned |
| **Regression Testing** | Compare outputs across versions | ğŸ”§ Planned |
| **Pipeline Lineage** | Impact analysis for changes | ğŸ”§ Planned |
| **Schema Evolution Testing** | Validate Avro/Protobuf changes | ğŸ”§ Planned |

---

## Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              USER INTERFACES                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   Studio    â”‚  â”‚    CLI      â”‚  â”‚  REST API   â”‚  â”‚ MCP Server  â”‚        â”‚
â”‚  â”‚  (Web UI)   â”‚  â”‚ velo run    â”‚  â”‚  /api/*     â”‚  â”‚ (AI Agents) â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚                â”‚                â”‚                â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                â”‚                â”‚                â”‚
          â–¼                â–¼                â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           VELOSTREAM CORE                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                         SQL Engine                                     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚  â”‚
â”‚  â”‚  â”‚  Parser  â”‚â†’ â”‚ Planner  â”‚â†’ â”‚ Executor â”‚â†’ â”‚  Output  â”‚              â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚  Connectors   â”‚  â”‚ Test Harness  â”‚  â”‚  Observability â”‚                   â”‚
â”‚  â”‚  Kafka, PG,   â”‚  â”‚  FR-084       â”‚  â”‚  @metrics      â”‚                   â”‚
â”‚  â”‚  Redis, File  â”‚  â”‚  Synthetic    â”‚  â”‚  Prometheus    â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           TURNKEY APPS                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   Black Box     â”‚  â”‚    Cluster      â”‚  â”‚    Semantic     â”‚              â”‚
â”‚  â”‚   Recorder      â”‚  â”‚    Linker       â”‚  â”‚    Lineage      â”‚              â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚              â”‚
â”‚  â”‚ â€¢ Agent SDK     â”‚  â”‚ â€¢ Multi-vendor  â”‚  â”‚ â€¢ Data tracing  â”‚              â”‚
â”‚  â”‚ â€¢ Decision log  â”‚  â”‚ â€¢ Cross-region  â”‚  â”‚ â€¢ AI explain    â”‚              â”‚
â”‚  â”‚ â€¢ Replay API    â”‚  â”‚ â€¢ 80% cheaper   â”‚  â”‚ â€¢ Compliance    â”‚              â”‚
â”‚  â”‚ â€¢ Dashboard     â”‚  â”‚ â€¢ CLI + API     â”‚  â”‚ â€¢ Audit trail   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ENTERPRISE FEATURES                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Auth    â”‚  â”‚   Audit   â”‚  â”‚ Clusteringâ”‚  â”‚   Chaos   â”‚  â”‚  Lineage  â”‚ â”‚
â”‚  â”‚ SSO/SAML  â”‚  â”‚  Logging  â”‚  â”‚ Multi-nodeâ”‚  â”‚  Testing  â”‚  â”‚  Tracking â”‚ â”‚
â”‚  â”‚   RBAC    â”‚  â”‚ Complianceâ”‚  â”‚    HA     â”‚  â”‚ Regressionâ”‚  â”‚  Impact   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Crate Structure

```
velostream/
â”œâ”€â”€ velostream-core/           # Open Source (Apache 2.0)
â”‚   â”œâ”€â”€ sql/                   # SQL parser, planner, executor
â”‚   â”œâ”€â”€ connectors/            # Kafka, Postgres, Redis, File
â”‚   â”œâ”€â”€ serialization/         # JSON, Avro, Protobuf
â”‚   â”œâ”€â”€ test-harness/          # FR-084: synthetic data, assertions
â”‚   â”œâ”€â”€ observability/         # @metrics, Prometheus
â”‚   â””â”€â”€ ipc/                   # FR-072: Python integration
â”‚
â”œâ”€â”€ velostream-studio/         # Open Source (Apache 2.0)
â”‚   â”œâ”€â”€ api/                   # REST API (Axum)
â”‚   â”œâ”€â”€ websocket/             # Streaming results
â”‚   â””â”€â”€ ai/                    # Claude integration (NLâ†’SQL)
â”‚
â”œâ”€â”€ velostream-enterprise/     # Commercial License
â”‚   â”œâ”€â”€ auth/                  # SSO, SAML, OIDC, RBAC
â”‚   â”œâ”€â”€ audit/                 # Audit logging
â”‚   â”œâ”€â”€ clustering/            # Multi-node coordination
â”‚   â”œâ”€â”€ chaos/                 # Chaos testing
â”‚   â””â”€â”€ lineage/               # Pipeline lineage tracking
â”‚
â”œâ”€â”€ velostream-apps/           # Commercial License
â”‚   â”œâ”€â”€ blackbox-recorder/     # AI Black Box Recorder
â”‚   â”œâ”€â”€ cluster-linker/        # Kafka cluster linking
â”‚   â””â”€â”€ semantic-lineage/      # AI Semantic Lineage
â”‚
â””â”€â”€ studio-frontend/           # Open Source (Apache 2.0)
    â””â”€â”€ (Next.js application)
```

### Plugin Architecture

The enterprise and app features are loaded as plugins:

```rust
// Core defines extension traits
pub trait AuthProvider: Send + Sync {
    fn authenticate(&self, token: &str) -> Result<User>;
    fn authorize(&self, user: &User, resource: &str, action: &str) -> bool;
}

pub trait AuditSink: Send + Sync {
    fn log(&self, event: AuditEvent) -> Result<()>;
}

pub trait ClusterCoordinator: Send + Sync {
    fn join_cluster(&self, config: ClusterConfig) -> Result<NodeId>;
    fn get_leader(&self) -> Option<NodeId>;
}

// Open source provides basic implementations
pub struct BasicAuth { /* username/password */ }
pub struct NoOpAudit { /* does nothing */ }
pub struct SingleNode { /* no coordination */ }

// Enterprise provides advanced implementations
// (in velostream-enterprise crate)
pub struct SamlAuth { /* SSO integration */ }
pub struct ComplianceAudit { /* full audit trail */ }
pub struct RaftCluster { /* distributed coordination */ }
```

### License Check

```rust
// At startup
fn main() {
    let license = License::load_from_env_or_file();
    let mut runtime = VelostreamRuntime::new();

    // Always load core
    runtime.register_auth(BasicAuth::new());
    runtime.register_audit(NoOpAudit::new());

    // Load enterprise if licensed
    if license.has_feature(Feature::SSO) {
        runtime.register_auth(SamlAuth::from_config(&config)?);
    }
    if license.has_feature(Feature::AuditLog) {
        runtime.register_audit(ComplianceAudit::new(&config)?);
    }
    if license.has_feature(Feature::Clustering) {
        runtime.enable_clustering(RaftCluster::new(&config)?);
    }

    runtime.run().await
}
```

---

## Turnkey Apps Architecture

### AI Black Box Recorder

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AI BLACK BOX RECORDER                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚   Your AI       â”‚                                                        â”‚
â”‚  â”‚   Agent         â”‚                                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚           â”‚                                                                  â”‚
â”‚           â”‚ pip install velostream-blackbox                                  â”‚
â”‚           â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚   Python SDK    â”‚                                                        â”‚
â”‚  â”‚                 â”‚                                                        â”‚
â”‚  â”‚ @record_decisionâ”‚                                                        â”‚
â”‚  â”‚ def my_agent(): â”‚                                                        â”‚
â”‚  â”‚     ...         â”‚                                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚           â”‚                                                                  â”‚
â”‚           â”‚ Kafka / HTTP                                                     â”‚
â”‚           â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    Velostream Black Box                              â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚    â”‚
â”‚  â”‚  â”‚   Ingest     â”‚â†’ â”‚   Process    â”‚â†’ â”‚   Store      â”‚               â”‚    â”‚
â”‚  â”‚  â”‚   Decisions  â”‚  â”‚   Enrich     â”‚  â”‚   Index      â”‚               â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚    â”‚
â”‚  â”‚  â”‚   Query      â”‚  â”‚   Replay     â”‚  â”‚   Analyze    â”‚               â”‚    â”‚
â”‚  â”‚  â”‚   API        â”‚  â”‚   Console    â”‚  â”‚   Dashboard  â”‚               â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  Endpoints:                                                                  â”‚
â”‚  â€¢ POST /api/decisions         - Record a decision                          â”‚
â”‚  â€¢ GET  /api/decisions/{id}    - Get decision by ID                         â”‚
â”‚  â€¢ POST /api/decisions/search  - Search decisions                           â”‚
â”‚  â€¢ POST /api/decisions/replay  - Replay a decision                          â”‚
â”‚  â€¢ GET  /api/agents            - List agents                                â”‚
â”‚  â€¢ GET  /metrics               - Prometheus metrics                         â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Python SDK Example:**
```python
from velostream_blackbox import BlackBoxClient, record_decision

client = BlackBoxClient("http://blackbox:8080")

@record_decision(client)
def process_loan_application(application):
    # Your AI logic here
    context = gather_context(application)
    decision = model.predict(context)
    return decision

# Later: replay a specific decision
decision = client.get_decision("dec_abc123")
replayed = client.replay(decision.id, with_context=decision.context)
```

---

### Cluster Linker

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           CLUSTER LINKER                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚  Kafka Cluster  â”‚         â”‚  Kafka Cluster  â”‚                            â”‚
â”‚  â”‚    US-East      â”‚         â”‚    US-West      â”‚                            â”‚
â”‚  â”‚   (Confluent)   â”‚         â”‚     (MSK)       â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚           â”‚                           â”‚                                      â”‚
â”‚           â”‚                           â”‚                                      â”‚
â”‚           â–¼                           â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      Velostream Cluster Linker                       â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚                     Link Configuration                        â”‚   â”‚    â”‚
â”‚  â”‚  â”‚                                                               â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  velo link create \                                           â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    --source kafka://us-east.confluent.cloud/orders \          â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    --target kafka://us-west.msk.amazonaws.com/orders \        â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    --transform "SELECT * WHERE region = 'west'"               â”‚   â”‚    â”‚
â”‚  â”‚  â”‚                                                               â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Features:                                                           â”‚    â”‚
â”‚  â”‚  â€¢ Multi-vendor (Confluent, MSK, Redpanda, self-hosted)             â”‚    â”‚
â”‚  â”‚  â€¢ Cross-region / cross-cloud                                        â”‚    â”‚
â”‚  â”‚  â€¢ SQL transforms during replication                                 â”‚    â”‚
â”‚  â”‚  â€¢ Schema translation (Avro â†” JSON â†” Protobuf)                      â”‚    â”‚
â”‚  â”‚  â€¢ Exactly-once delivery                                             â”‚    â”‚
â”‚  â”‚  â€¢ Compression + batching                                            â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Pricing: $0.05/GB (vs Confluent $0.15/GB)                          â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚           â”‚                           â”‚                                      â”‚
â”‚           â–¼                           â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚  Kafka Cluster  â”‚         â”‚  Kafka Cluster  â”‚                            â”‚
â”‚  â”‚      EU         â”‚         â”‚    APAC         â”‚                            â”‚
â”‚  â”‚   (Redpanda)    â”‚         â”‚  (Self-hosted)  â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### AI Semantic Lineage

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AI SEMANTIC LINEAGE                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Question: "Why did the AI deny loan #4821?"                                â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                         Lineage Trace                                â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Decision: Loan #4821 DENIED                                         â”‚    â”‚
â”‚  â”‚  Timestamp: 2025-11-27 14:32:01                                      â”‚    â”‚
â”‚  â”‚  Agent: loan-underwriter-v3                                          â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Data Sources:                                                       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚ credit_bureau.score = 612                                      â”‚  â”‚    â”‚
â”‚  â”‚  â”‚   â””â”€â”€ Source: kafka://credit-scores                            â”‚  â”‚    â”‚
â”‚  â”‚  â”‚   â””â”€â”€ Latency: 200ms (stale warning)                           â”‚  â”‚    â”‚
â”‚  â”‚  â”‚   â””â”€â”€ Last updated: 2025-11-27 14:31:58                        â”‚  â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚    â”‚
â”‚  â”‚  â”‚ transaction_history.avg_balance = $2,341                       â”‚  â”‚    â”‚
â”‚  â”‚  â”‚   â””â”€â”€ Source: postgres://accounts/transactions                 â”‚  â”‚    â”‚
â”‚  â”‚  â”‚   â””â”€â”€ Query: AVG(balance) WHERE customer_id = 'C-4821'         â”‚  â”‚    â”‚
â”‚  â”‚  â”‚   â””â”€â”€ Records: 847                                             â”‚  â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚    â”‚
â”‚  â”‚  â”‚ employment.verified = false  âš ï¸ ISSUE DETECTED                 â”‚  â”‚    â”‚
â”‚  â”‚  â”‚   â””â”€â”€ Source: api://employment-verification                    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚   â””â”€â”€ Status: HTTP 503 (API call failed!)                      â”‚  â”‚    â”‚
â”‚  â”‚  â”‚   â””â”€â”€ Fallback: Used cached value from 30 days ago             â”‚  â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚    â”‚
â”‚  â”‚  â”‚ fraud_model.risk_score = 0.73                                  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚   â””â”€â”€ Source: model://fraud-detector-v2                        â”‚  â”‚    â”‚
â”‚  â”‚  â”‚   â””â”€â”€ Features: [velocity, amount, merchant_category]          â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  AI Analysis:                                                        â”‚    â”‚
â”‚  â”‚  "The decision was primarily influenced by the failed employment    â”‚    â”‚
â”‚  â”‚   verification. The API returned 503, and the fallback used stale   â”‚    â”‚
â”‚  â”‚   data from 30 days ago. Recommend: retry with fresh verification." â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  [Replay Decision] [Compare Similar] [Create Alert Rule]            â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Studio Architecture

See [NOTEBOOK_DESIGN.md](./NOTEBOOK_DESIGN.md) for detailed Studio implementation.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         VELOSTREAM STUDIO                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Frontend (Next.js)                                                          â”‚
â”‚  â”œâ”€â”€ Notebook Interface     - Cell-based SQL development                    â”‚
â”‚  â”œâ”€â”€ NLâ†’SQL Chat           - Natural language to streaming SQL              â”‚
â”‚  â”œâ”€â”€ Live Visualizations   - Auto-selected charts, real-time updates        â”‚
â”‚  â”œâ”€â”€ Test Results          - Inline pass/fail with AI analysis              â”‚
â”‚  â””â”€â”€ Deploy Wizard         - Notebook â†’ Production pipeline                 â”‚
â”‚                                                                              â”‚
â”‚  Backend (Rust/Axum)                                                         â”‚
â”‚  â”œâ”€â”€ /api/validate         - SQL validation                                 â”‚
â”‚  â”œâ”€â”€ /api/execute          - Query execution                                â”‚
â”‚  â”œâ”€â”€ /api/nl-to-sql        - AI-powered SQL generation                      â”‚
â”‚  â”œâ”€â”€ /api/test             - FR-084 test harness integration                â”‚
â”‚  â”œâ”€â”€ /api/completions      - AI code completions                            â”‚
â”‚  â”œâ”€â”€ /api/notebooks        - Notebook CRUD                                  â”‚
â”‚  â”œâ”€â”€ /api/deploy           - Pipeline deployment                            â”‚
â”‚  â””â”€â”€ /api/dashboards       - Grafana dashboard generation                   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## MCP Server Architecture

To compete with Lenses.io, Velostream needs an MCP server for AI agent integration.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         VELOSTREAM MCP SERVER                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   Claude    â”‚  â”‚   VS Code   â”‚  â”‚   Cursor    â”‚  â”‚   Custom    â”‚        â”‚
â”‚  â”‚   Desktop   â”‚  â”‚   + Copilot â”‚  â”‚             â”‚  â”‚   Agent     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚                â”‚                â”‚                â”‚                â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                    â”‚                                         â”‚
â”‚                                    â”‚ MCP Protocol                            â”‚
â”‚                                    â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                     velostream-mcp-server                            â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Tools:                                                              â”‚    â”‚
â”‚  â”‚  â€¢ list_streams()        - List available Kafka topics/streams       â”‚    â”‚
â”‚  â”‚  â€¢ describe_stream()     - Get schema, sample data                   â”‚    â”‚
â”‚  â”‚  â€¢ query_stream()        - Execute streaming SQL, return results     â”‚    â”‚
â”‚  â”‚  â€¢ validate_sql()        - Check SQL syntax                          â”‚    â”‚
â”‚  â”‚  â€¢ generate_test_data()  - Create synthetic data for testing         â”‚    â”‚
â”‚  â”‚  â€¢ run_test()            - Execute test with assertions              â”‚    â”‚
â”‚  â”‚  â€¢ get_metrics()         - Fetch current metric values               â”‚    â”‚
â”‚  â”‚  â€¢ deploy_query()        - Deploy SQL as production job              â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Resources:                                                          â”‚    â”‚
â”‚  â”‚  â€¢ streams://{name}      - Stream schema and metadata                â”‚    â”‚
â”‚  â”‚  â€¢ metrics://{name}      - Metric definition and current value       â”‚    â”‚
â”‚  â”‚  â€¢ jobs://{id}           - Running job status                        â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                    â”‚                                         â”‚
â”‚                                    â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                       Velostream Core                                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Example MCP Interaction:**
```
User (in Claude): "What's the schema of the orders stream?"

Claude â†’ MCP: describe_stream("orders")

MCP â†’ Claude: {
  "name": "orders",
  "format": "avro",
  "columns": [
    {"name": "order_id", "type": "STRING"},
    {"name": "customer_id", "type": "STRING"},
    {"name": "amount", "type": "DECIMAL(18,4)"},
    {"name": "timestamp", "type": "TIMESTAMP"}
  ],
  "sample": [
    {"order_id": "ORD-001", "customer_id": "C-123", "amount": "99.99", ...}
  ]
}

Claude â†’ User: "The orders stream has 4 columns: order_id (STRING),
               customer_id (STRING), amount (DECIMAL), and timestamp."
```

---

## Security Model

### Open Source

- Basic auth (username/password)
- API key authentication
- No audit logging
- Single-node only

### Enterprise

| Feature | Description |
|---------|-------------|
| **SSO/SAML** | Integrate with Okta, Auth0, Azure AD, etc. |
| **OIDC** | OpenID Connect for OAuth2 flows |
| **RBAC** | Role-based access control |
| **Audit Logs** | All actions logged for compliance |
| **Encryption** | At-rest and in-transit encryption |
| **Data Masking** | PII masking for non-prod environments |

### RBAC Model

```yaml
roles:
  - name: admin
    permissions:
      - streams:*
      - jobs:*
      - notebooks:*
      - deploy:*
      - users:*

  - name: developer
    permissions:
      - streams:read
      - jobs:read
      - notebooks:*
      - deploy:staging

  - name: analyst
    permissions:
      - streams:read
      - notebooks:read
      - notebooks:execute
```

---

## Deployment Options

### Single Binary (Open Source)

```bash
# Install
curl -sSL https://velostream.dev/install | bash

# Run
velo run query.sql --source kafka://localhost:9092/orders

# With Studio
velo studio --port 3000
```

### Docker Compose (Open Source)

```yaml
services:
  velostream:
    image: velostream/velostream:latest
    ports:
      - "8080:8080"
      - "3000:3000"
    environment:
      - KAFKA_BOOTSTRAP_SERVERS=kafka:9092
```

### Kubernetes (Enterprise)

```yaml
apiVersion: velostream.io/v1
kind: VelostreamCluster
metadata:
  name: production
spec:
  replicas: 3
  license:
    secretRef: velostream-license
  auth:
    provider: saml
    issuer: https://idp.company.com
  clustering:
    enabled: true
```

---

## Related Documents

- [README.md](./README.md) - Project overview and quick start
- [NOTEBOOK_DESIGN.md](./NOTEBOOK_DESIGN.md) - Detailed Studio/notebook implementation
- [API.md](./API.md) - REST API specification
- [TODO.md](./TODO.md) - Implementation tasks and progress
- [COMPETITIVE_ANALYSIS.md](./COMPETITIVE_ANALYSIS.md) - Market analysis and positioning
