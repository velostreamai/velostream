# Velostream Trading Demo Makefile
# Builds main project and runs trading demo

.PHONY: all build run run-short clean help test validate

# Default target
all: build

# Build main project
build:
	@echo "ğŸ”¨ Building Velostream main project..."
	@cd ../.. && cargo build --release --bin velo-test --bin velo-sql
	@echo "âœ… Build complete!"

# Run the trading demo
run: build
	@echo "ğŸš€ Starting Velostream Trading Demo..."
	./start-demo.sh

# Run a short demo (1 minute)
run-short: build
	@echo "ğŸš€ Starting short Velostream Trading Demo (1 minute)..."
	./start-demo.sh -q

# Validate SQL syntax
validate:
	@echo "ğŸ” Validating SQL files..."
	@../../target/release/velo-test validate apps/app_market_data.sql
	@echo "âœ… Validation complete"

# Run tests
test:
	@echo "ğŸ§ª Running tests..."
	@./velo-test.sh
	@echo "âœ… Tests complete"

# Clean demo artifacts
clean:
	@echo "ğŸ§¹ Cleaning demo artifacts..."
	@rm -f velo-cli
	@echo "âœ… Clean complete"

# Show help
help:
	@echo "Velostream Trading Demo Build System"
	@echo "======================================="
	@echo ""
	@echo "Available targets:"
	@echo "  build       - Build main project binaries (default)"
	@echo "  run         - Build and run the full demo"
	@echo "  run-short   - Build and run 1-minute demo"
	@echo "  validate    - Validate SQL syntax"
	@echo "  test        - Run test suite"
	@echo "  clean       - Remove artifacts"
	@echo "  help        - Show this help message"
	@echo ""
	@echo "Examples:"
	@echo "  make                    # Build main project"
	@echo "  make run                # Build and run demo"
	@echo "  make run-short          # Quick 1-minute demo"
	@echo "  make validate           # Check SQL syntax"
	@echo ""
	@echo "Note: This demo uses velo-test for data generation via @data.* hints"
