# Market Data Schema for Test Harness
# Generates realistic market data events with financial precision
#
# Based on: schemas/market_data.avsc
#
# NEW: Uses Geometric Brownian Motion (GBM) for realistic price paths
# Each symbol has its own independent price trajectory that follows
# realistic market dynamics with configurable drift and volatility.

name: market_data
description: High-frequency market data with GBM-based realistic price simulation

fields:
  - name: symbol
    type: string
    description: Trading symbol (e.g., AAPL, MSFT)
    constraints:
      enum_values:
        values: [AAPL, GOOGL, MSFT, AMZN, META, NVDA, TSLA]
        weights: [0.20, 0.15, 0.15, 0.15, 0.10, 0.15, 0.10]

  - name: exchange
    type: string
    description: Exchange identifier
    constraints:
      enum_values:
        values: [NYSE, NASDAQ, CBOE]
        weights: [0.40, 0.50, 0.10]

  - name: timestamp
    type: integer
    description: Market data timestamp (epoch milliseconds)
    constraints:
      timestamp_epoch_ms:
        start: "-5m"
        end: "now"

  - name: price
    type:
      decimal:
        precision: 4
    description: Current price using Geometric Brownian Motion for realistic paths
    constraints:
      range:
        min: 150.0   # Initial price for new symbols (realistic tech stock range)
        max: 500.0   # Price ceiling to prevent runaway
      distribution:
        random_walk:
          drift: 0.0001       # ~0.01% expected return per tick (slight upward bias)
          volatility: 0.015   # 1.5% standard deviation per tick
          group_by: symbol    # Each symbol has its own independent price path

  - name: bid_price
    type:
      decimal:
        precision: 4
    description: Best bid price
    nullable: false
    constraints:
      derived:
        expression: "price * random(0.995, 0.999)"
        depends_on: [price]

  - name: ask_price
    type:
      decimal:
        precision: 4
    description: Best ask price
    nullable: false
    constraints:
      derived:
        expression: "price * random(1.001, 1.005)"
        depends_on: [price]

  - name: bid_size
    type: integer
    description: Bid quantity
    constraints:
      range:
        min: 100
        max: 10000
      distribution: uniform

  - name: ask_size
    type: integer
    description: Ask quantity
    constraints:
      range:
        min: 100
        max: 10000
      distribution: uniform

  - name: volume
    type: integer
    description: Trading volume
    constraints:
      range:
        min: 1000
        max: 1000000
      distribution:
        log_normal:
          mean: 12.0
          std_dev: 2.0

  - name: vwap
    type:
      decimal:
        precision: 4
    description: Volume-weighted average price
    nullable: true
    constraints:
      derived:
        expression: "price * random(0.98, 1.02)"
        depends_on: [price]

  - name: market_cap
    type:
      decimal:
        precision: 2
    description: Market capitalization
    nullable: true
    constraints:
      range:
        min: 1000000000.0
        max: 3000000000000.0
