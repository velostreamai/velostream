# Market Data Stream Schema for Trading Demo - Exchange B
#
# Uses Geometric Brownian Motion (GBM) for realistic price paths.
# Exchange B has slightly lower prices than Exchange A to create
# occasional cross-exchange arbitrage opportunities for the demo.

name: in_market_data_stream_b
description: Exchange B market data feed with GBM-based price simulation (lower prices)
record_count: 100

fields:
  - name: symbol
    type: string
    nullable: false
    constraints:
      enum_values:
        values: ["AAPL", "GOOGL", "MSFT", "AMZN", "META"]
        weights: [0.25, 0.25, 0.2, 0.15, 0.15]

  - name: exchange
    type: string
    nullable: false
    constraints:
      enum_values:
        values: ["NASDAQ", "NYSE"]
        weights: [0.6, 0.4]

  - name: timestamp
    type: integer
    nullable: false
    constraints:
      timestamp_epoch_ms:
        start: "-1h"
        end: "now"

  - name: price
    type: float
    nullable: false
    description: Price using GBM - Exchange B trades slightly lower than Exchange A
    constraints:
      range:
        min: 148.0   # Slightly lower base than Exchange A (150)
        max: 395.0   # Slightly lower ceiling than Exchange A (400)
      distribution:
        random_walk:
          drift: -0.0002      # Slight downward bias (vs Exchange A's +0.0001)
          volatility: 0.025   # Higher volatility creates more arbitrage windows
          group_by: symbol    # Independent price path per symbol

  - name: bid_price
    type: float
    nullable: false
    constraints:
      derived:
        expression: "price * random(0.998, 0.9999)"
        depends_on: [price]

  - name: ask_price
    type: float
    nullable: false
    constraints:
      derived:
        expression: "price * random(1.0001, 1.002)"
        depends_on: [price]

  - name: bid_size
    type: integer
    nullable: false
    constraints:
      range:
        min: 100
        max: 10000

  - name: ask_size
    type: integer
    nullable: false
    constraints:
      range:
        min: 100
        max: 10000

  - name: volume
    type: integer
    nullable: false
    constraints:
      range:
        min: 1000
        max: 500000
      distribution:
        log_normal:
          mean: 10.0
          std_dev: 1.5

  - name: vwap
    type: float
    nullable: false
    constraints:
      derived:
        expression: "price * random(0.995, 1.005)"
        depends_on: [price]

  - name: market_cap
    type: integer
    nullable: false
    constraints:
      range:
        min: 100000000000
        max: 3000000000000
