application: dlq_basic_demo
description: Test DLQ captures failed records
default_timeout_ms: 60000
default_records: 100

# Fault injection to create some failures
fault_injection:
  enable_dlq: true
  dlq_max_size: 100

  malformed_records:
    enabled: true
    rate: 0.05        # 5% of records will be malformed
    types:
      - missing_field
      - wrong_type

queries:
  - name: processed_events
    description: Verify most records processed, failures go to DLQ
    inputs:
      - source: raw_events
        schema: event_record
        records: 100
    assertions:
      # Most records should succeed
      - type: record_count
        greater_than: 90

      # DLQ should capture some failures (when fault injection is wired up)
      - type: dlq_count
        greater_than: 0
        less_than: 15

      # Error rate should be low
      - type: error_rate
        max_percent: 15.0

      # Schema should contain expected output fields
      - type: schema_contains
        fields: [event_id, user_id, event_type, amount, event_time]

    timeout_ms: 60000
