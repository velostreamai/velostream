application: rows_buffer_demo
description: Test ROWS WINDOW BUFFER for fixed-size windows
default_timeout_ms: 60000
default_records: 100

queries:
  - name: buffered_analysis
    description: Verify row-based window calculations produce correct, non-null results
    inputs:
      - source: market_data
        schema: market_data
        records: 100
    assertions:
      - type: record_count
        equals: 100
      - type: schema_contains
        fields: [symbol, price, volume, avg_50, avg_200, stddev_100, min_100, max_100]
      - type: no_nulls
        fields: [symbol, price, volume, avg_50, avg_200]

      # Correctness: price and volume are positive market data
      - type: field_values
        field: price
        operator: greater_than
        value: 0
      - type: field_values
        field: volume
        operator: greater_than
        value: 0

      # Correctness: window averages must be positive (prices are always > 0)
      - type: field_values
        field: avg_50
        operator: greater_than
        value: 0
      - type: field_values
        field: avg_200
        operator: greater_than
        value: 0

      # Correctness: min/max must be positive (derived from positive prices)
      - type: field_values
        field: min_100
        operator: greater_than
        value: 0
      - type: field_values
        field: max_100
        operator: greater_than
        value: 0

      # Correctness: standard deviation is non-negative
      - type: field_values
        field: stddev_100
        operator: greater_than
        value: -0.001

    timeout_ms: 60000
