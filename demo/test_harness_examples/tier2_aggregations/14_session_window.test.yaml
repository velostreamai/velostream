application: session_window_demo
description: Test session window aggregation
default_timeout_ms: 120000
default_records: 500

queries:
  - name: session_output
    description: Verify session window groups user activity correctly
    inputs:
      - source: user_activity
        schema: user_activity
        records: 500
        time_simulation:
          start_time: "-5m"    # 5 minutes of activity
          end_time: "now"
          sequential: true
          jitter_ms: 5000      # 5s jitter creates natural gaps for session closure
    assertions:
      - type: record_count
        greater_than: 0
      - type: schema_contains
        fields: [user_id, actions_in_session, total_duration, session_start, session_end]
      - type: field_values
        field: actions_in_session
        operator: greater_than
        value: 0
      - type: field_values
        field: total_duration
        operator: greater_than_or_equals
        value: 0
      - type: no_nulls
        fields: [user_id, actions_in_session, total_duration]
    timeout_ms: 120000
