# File Data Sink Configuration
# For writing processed financial transactions to files with rotation

datasink:
  type: "file" 
  name: "processed_transactions_file"
  config:
    # Output file path (supports template variables)
    path: "./demo_output/processed_transactions.jsonl"
    
    # File format
    format: "json_lines"  # Options: "json_lines", "csv", "json_array"
    
    # File rotation settings
    rotation:
      enabled: true
      strategy: "size_and_time"  # Options: "size", "time", "size_and_time", "records"
      
      # Size-based rotation
      max_file_size: 1048576  # 1MB per file
      
      # Time-based rotation  
      rotation_interval: "1h"  # Options: "1m", "5m", "1h", "1d"
      
      # Record-based rotation
      max_records: 1000
      
      # File naming pattern
      naming_pattern: "processed_transactions_%Y%m%d_%H%M%S_%04d.jsonl"
      
    # Compression settings
    compression:
      enabled: true
      type: "gzip"  # Options: "gzip", "snappy", "zstd", "none"
      level: 6      # Compression level (1-9 for gzip)
      
    # Buffer settings for performance
    buffer:
      size: 65536   # 64KB write buffer  
      flush_interval_ms: 5000  # Flush every 5 seconds
      
    # Directory management
    directory:
      create_if_missing: true
      permissions: "755"
      
    # Error handling
    error_handling:
      on_write_error: "retry"  # Options: "retry", "skip", "fail"
      max_retries: 3
      retry_delay_ms: 1000
      
# Serialization configuration
serialization:
  format: "json"  # Always JSON for file output
  pretty_print: false  # Compact JSON for performance
  
  # Field formatting options
  field_formatting:
    timestamps:
      format: "iso8601"  # Options: "iso8601", "unix_seconds", "unix_millis"
    decimals:
      format: "string"   # Preserve exact precision as strings
      
# Processing settings
processing:
  # Batch writing for performance
  batch.size: 100
  batch_timeout_ms: 1000
  
  # Field transformations
  transformations:
    # Add file metadata
    add_fields:
      file_written_at: "@timestamp"
      file_batch_id: "@batch_id"
      
    # Remove sensitive fields (if any)
    exclude_fields: []
    
    # Field renaming
    field_mappings: {}
    
  # Async vs sync writing
  write_mode: "async"  # Options: "sync", "async"
  
  # Metrics
  metrics:
    enabled: true
    report_interval_ms: 10000
    
# File management settings
file_management:
  # Cleanup old files
  cleanup:
    enabled: true
    retention_days: 7  # Keep files for 7 days
    max_files: 100     # Keep maximum 100 files
    
  # File permissions
  file_permissions: "644"
  
  # Atomic writes (write to temp file then rename)
  atomic_writes: true
  
  # Sync to disk settings
  sync_writes: false  # For performance, set true for durability